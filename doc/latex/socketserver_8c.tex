\hypertarget{socketserver_8c}{\section{ulppk/socketserver.c File Reference}
\label{socketserver_8c}\index{ulppk/socketserver.\-c@{ulppk/socketserver.\-c}}
}


A skeletal socket server framework.  


{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$signal.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$sys/socket.\-h$>$}\\*
{\ttfamily \#include $<$sys/wait.\-h$>$}\\*
{\ttfamily \#include $<$netinet/in.\-h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include \char`\"{}socketserver.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}diagnostics.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}signalkit.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}cmdargs.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$ \hyperlink{socketserver_8c_a24a7df39baa92f201cc4b3363c9269b9}{ssrvr\-\_\-new} ()
\begin{DoxyCompactList}\small\item\em This function constructs a new socket server handle structure. Personality functions are initialize to stubs. \end{DoxyCompactList}\item 
void \hyperlink{socketserver_8c_a55037243928240d88775a206f501da6b}{ssrvr\-\_\-register\-\_\-clpf} (\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$p\-Handle, \hyperlink{socketserver_8h_ae54a889b2c55c9138d924abef8f51d3b}{S\-S\-R\-V\-R\-\_\-\-C\-L\-P\-F} $\ast$clpf)
\begin{DoxyCompactList}\small\item\em Register a Command Line Personality Function (C\-L\-P\-F) \end{DoxyCompactList}\item 
void \hyperlink{socketserver_8c_ab662215cc86e0aa72c4bd66fc7124e4e}{ssrvr\-\_\-register\-\_\-ipf} (\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$p\-Handle, \hyperlink{socketserver_8h_a93d8d401108d91cfcd784619941ac535}{S\-S\-R\-V\-R\-\_\-\-I\-P\-F} $\ast$ipf)
\begin{DoxyCompactList}\small\item\em Register an Initialization Personality Function (I\-P\-F) \end{DoxyCompactList}\item 
void \hyperlink{socketserver_8c_ab4efe2c9a4d2757d674f19b6b80b748f}{ssrvr\-\_\-register\-\_\-mpf} (\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$p\-Handle, \hyperlink{socketserver_8h_a4439dfce658b2313b3a6352eeb6f7e9c}{S\-S\-R\-V\-R\-\_\-\-M\-P\-F} $\ast$mpf)
\begin{DoxyCompactList}\small\item\em Register a Main Personality Function (M\-P\-F) \end{DoxyCompactList}\item 
void \hyperlink{socketserver_8c_a28fff67c7dc41d2f10d5878656446e7a}{ssrvr\-\_\-register\-\_\-ctpf} (\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$p\-Handle, \hyperlink{socketserver_8h_a54951c949426b1745d6345943b763cf1}{S\-S\-R\-V\-R\-\_\-\-C\-T\-P\-F} $\ast$ctpf)
\begin{DoxyCompactList}\small\item\em Register a Child Termination Personality Function (C\-T\-P\-F) \end{DoxyCompactList}\item 
void \hyperlink{socketserver_8c_a097c24caa6a3ba22e3422bfc55b31cb0}{ssrvr\-\_\-register\-\_\-ptpf} (\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$p\-Handle, \hyperlink{socketserver_8h_aba79a85fcc6b3f7f9e9a2a668309042d}{S\-S\-R\-V\-R\-\_\-\-P\-T\-P\-F} $\ast$ptpf)
\begin{DoxyCompactList}\small\item\em Register a Parent Termination Personality Function (P\-T\-P\-F) \end{DoxyCompactList}\item 
int \hyperlink{socketserver_8c_ade7bf3f71c25aca640f42d5669ce2347}{ssrvr\-\_\-start} (\hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$p\-Handle, void $\ast$datap, int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Start the socket server. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct sockaddr\-\_\-in \hyperlink{socketserver_8c_abfd7055d6d36d153883e6ba685637515}{local\-\_\-addr}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
A skeletal socket server framework. See \hyperlink{socketserver_8h}{socketserver.\-h} for a overview of the socket server skeleton, command line options it processes, and the life cycle of a socket server. 

Definition in file \hyperlink{socketserver_8c_source}{socketserver.\-c}.



\subsection{Function Documentation}
\hypertarget{socketserver_8c_a24a7df39baa92f201cc4b3363c9269b9}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-new@{ssrvr\-\_\-new}}
\index{ssrvr\-\_\-new@{ssrvr\-\_\-new}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-new}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E}$\ast$ ssrvr\-\_\-new (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_a24a7df39baa92f201cc4b3363c9269b9}


This function constructs a new socket server handle structure. Personality functions are initialize to stubs. 

\begin{DoxyReturn}{Returns}
pointer to a socket server handle structure. 
\end{DoxyReturn}


Definition at line 207 of file socketserver.\-c.

\hypertarget{socketserver_8c_a55037243928240d88775a206f501da6b}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-register\-\_\-clpf@{ssrvr\-\_\-register\-\_\-clpf}}
\index{ssrvr\-\_\-register\-\_\-clpf@{ssrvr\-\_\-register\-\_\-clpf}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-register\-\_\-clpf}]{\setlength{\rightskip}{0pt plus 5cm}void ssrvr\-\_\-register\-\_\-clpf (
\begin{DoxyParamCaption}
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$}]{p\-Handle, }
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-C\-L\-P\-F} $\ast$}]{clpf}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_a55037243928240d88775a206f501da6b}


Register a Command Line Personality Function (C\-L\-P\-F) 

Once a handle is created, personality functions may be registered.

If there are custom command line arguments to add (in addition to the stock command line options ever socket server skeleton must handle), then a C\-L\-P\-F should be implemented and registered by calling this function. The C\-L\-P\-F should simply call the cmdarg\-\_\-register\-\_\-option function to register these custom arguments.


\begin{DoxyParams}{Parameters}
{\em p\-Handle} & Pointer to \hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} returned by ssrvr\-\_\-new \\
\hline
{\em clpf} & Pointer to Command Line Personality Function \\
\hline
\end{DoxyParams}


Definition at line 231 of file socketserver.\-c.

\hypertarget{socketserver_8c_a28fff67c7dc41d2f10d5878656446e7a}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-register\-\_\-ctpf@{ssrvr\-\_\-register\-\_\-ctpf}}
\index{ssrvr\-\_\-register\-\_\-ctpf@{ssrvr\-\_\-register\-\_\-ctpf}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-register\-\_\-ctpf}]{\setlength{\rightskip}{0pt plus 5cm}void ssrvr\-\_\-register\-\_\-ctpf (
\begin{DoxyParamCaption}
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$}]{p\-Handle, }
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-C\-T\-P\-F} $\ast$}]{ctpf}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_a28fff67c7dc41d2f10d5878656446e7a}


Register a Child Termination Personality Function (C\-T\-P\-F) 

Once a handle is created, personality functions may be registered.

The C\-T\-P\-F is called by ssrvr\-\_\-start after the M\-P\-F has returned to the child skeleton. A C\-T\-P\-F should be implemented to perform any \char`\"{}must do\char`\"{} clean up after the M\-P\-F has completed processing.


\begin{DoxyParams}{Parameters}
{\em p\-Handle} & Pointer to \hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} returned by ssrvr\-\_\-new \\
\hline
{\em ctpf} & Pointer to Child Termination Personality Function \\
\hline
\end{DoxyParams}


Definition at line 279 of file socketserver.\-c.

\hypertarget{socketserver_8c_ab662215cc86e0aa72c4bd66fc7124e4e}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-register\-\_\-ipf@{ssrvr\-\_\-register\-\_\-ipf}}
\index{ssrvr\-\_\-register\-\_\-ipf@{ssrvr\-\_\-register\-\_\-ipf}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-register\-\_\-ipf}]{\setlength{\rightskip}{0pt plus 5cm}void ssrvr\-\_\-register\-\_\-ipf (
\begin{DoxyParamCaption}
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$}]{p\-Handle, }
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-I\-P\-F} $\ast$}]{ipf}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_ab662215cc86e0aa72c4bd66fc7124e4e}


Register an Initialization Personality Function (I\-P\-F) 

The I\-P\-F is called by ssrvr\-\_\-start after the C\-L\-P\-F (Command Line Personality Function) has been called to register any special command line options, and the command line options have been parsed. The C\-L\-P\-F should register those options O\-N\-L\-Y. The I\-P\-F can read the option values.


\begin{DoxyParams}{Parameters}
{\em p\-Handle} & Pointer to \hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} returned by ssrvr\-\_\-new \\
\hline
{\em ipf} & Pointer to Initialization Personality Function \\
\hline
\end{DoxyParams}


Definition at line 247 of file socketserver.\-c.

\hypertarget{socketserver_8c_ab4efe2c9a4d2757d674f19b6b80b748f}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-register\-\_\-mpf@{ssrvr\-\_\-register\-\_\-mpf}}
\index{ssrvr\-\_\-register\-\_\-mpf@{ssrvr\-\_\-register\-\_\-mpf}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-register\-\_\-mpf}]{\setlength{\rightskip}{0pt plus 5cm}void ssrvr\-\_\-register\-\_\-mpf (
\begin{DoxyParamCaption}
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$}]{p\-Handle, }
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-M\-P\-F} $\ast$}]{mpf}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_ab4efe2c9a4d2757d674f19b6b80b748f}


Register a Main Personality Function (M\-P\-F) 

Once a handle is created, personality functions may be registered.

The M\-P\-F is called by ssrvr\-\_\-start after a socket connection has been accepted. The M\-P\-F runs under a child process. The parent process loops to accept a new connection.


\begin{DoxyParams}{Parameters}
{\em p\-Handle} & Pointer to \hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} returned by ssrvr\-\_\-new \\
\hline
{\em mpf} & Pointer to Main Personality Function \\
\hline
\end{DoxyParams}


Definition at line 263 of file socketserver.\-c.

\hypertarget{socketserver_8c_a097c24caa6a3ba22e3422bfc55b31cb0}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-register\-\_\-ptpf@{ssrvr\-\_\-register\-\_\-ptpf}}
\index{ssrvr\-\_\-register\-\_\-ptpf@{ssrvr\-\_\-register\-\_\-ptpf}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-register\-\_\-ptpf}]{\setlength{\rightskip}{0pt plus 5cm}void ssrvr\-\_\-register\-\_\-ptpf (
\begin{DoxyParamCaption}
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$}]{p\-Handle, }
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-P\-T\-P\-F} $\ast$}]{ptpf}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_a097c24caa6a3ba22e3422bfc55b31cb0}


Register a Parent Termination Personality Function (P\-T\-P\-F) 

Once a handle is created, personality functions may be registered.

The P\-T\-P\-F is called by ssrvr\-\_\-start after main accept loop has been terminated. Loop termination (loop abort) will occur when a S\-I\-G\-T\-E\-R\-M is sent to the parent. A P\-T\-P\-F should be implemented to perform any\char`\"{}must do\char`\"{} clean up after the accept loop has been aborted.


\begin{DoxyParams}{Parameters}
{\em p\-Handle} & Pointer to \hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} returned by ssrvr\-\_\-new \\
\hline
{\em ptpf} & Pointer to Parent Termination Personality Function \\
\hline
\end{DoxyParams}


Definition at line 297 of file socketserver.\-c.

\hypertarget{socketserver_8c_ade7bf3f71c25aca640f42d5669ce2347}{\index{socketserver.\-c@{socketserver.\-c}!ssrvr\-\_\-start@{ssrvr\-\_\-start}}
\index{ssrvr\-\_\-start@{ssrvr\-\_\-start}!socketserver.c@{socketserver.\-c}}
\subsubsection[{ssrvr\-\_\-start}]{\setlength{\rightskip}{0pt plus 5cm}int ssrvr\-\_\-start (
\begin{DoxyParamCaption}
\item[{{\bf S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} $\ast$}]{p\-Handle, }
\item[{void $\ast$}]{datap, }
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{socketserver_8c_ade7bf3f71c25aca640f42d5669ce2347}


Start the socket server. 

Once the required personality functions have been registered, the socket server can be started by calling this function. This function parses command line arguments, drives the calls to the registered personality functions, handles listen socket setup, and accepts connections. To terminate the accept loop, send a S\-I\-G\-T\-E\-R\-M to the parent process.


\begin{DoxyParams}{Parameters}
{\em p\-Handle} & Pointer to \hyperlink{struct_s_s_r_v_r___h_a_n_d_l_e}{S\-S\-R\-V\-R\-\_\-\-H\-A\-N\-D\-L\-E} returned by ssrvr\-\_\-new \\
\hline
{\em datap} & Pointer to application data. All personality functions will have access to this pointer. \\
\hline
{\em argc} & Program argument count, as passed to the \hyperlink{dequetool_8c_a0ddf1224851353fc92bfbff6f499fa97}{main()} funtion \\
\hline
{\em argv} & Array of program argument strings, as passed to the \hyperlink{dequetool_8c_a0ddf1224851353fc92bfbff6f499fa97}{main()} funciton. \\
\hline
\end{DoxyParams}


Definition at line 317 of file socketserver.\-c.



\subsection{Variable Documentation}
\hypertarget{socketserver_8c_abfd7055d6d36d153883e6ba685637515}{\index{socketserver.\-c@{socketserver.\-c}!local\-\_\-addr@{local\-\_\-addr}}
\index{local\-\_\-addr@{local\-\_\-addr}!socketserver.c@{socketserver.\-c}}
\subsubsection[{local\-\_\-addr}]{\setlength{\rightskip}{0pt plus 5cm}struct sockaddr\-\_\-in local\-\_\-addr}}\label{socketserver_8c_abfd7055d6d36d153883e6ba685637515}


Definition at line 69 of file socketserver.\-c.

