\hypertarget{trap_8c}{\section{ulppk/trap.c File Reference}
\label{trap_8c}\index{ulppk/trap.\-c@{ulppk/trap.\-c}}
}
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$sys/types.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$trap.\-h$>$}\\*
{\ttfamily \#include $<$ioutils.\-h$>$}\\*
{\ttfamily \#include $<$ulppk\-\_\-log.\-h$>$}\\*
{\ttfamily \#include $<$sysconfig.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
char $\ast$ \hyperlink{trap_8c_a1d87e482edbb84f52b378e13112ac005}{trap\-\_\-read\-\_\-trapfile} (\hyperlink{struct_i_n_i_f_i_l_e___n_o_d_e}{I\-N\-I\-F\-I\-L\-E\-\_\-\-N\-O\-D\-E} $\ast$inifilep)
\begin{DoxyCompactList}\small\item\em Get the trap file name from the system initialization file. The function presumes sysconfig\-\_\-parse\-\_\-inifile has already occurred. \end{DoxyCompactList}\item 
int \hyperlink{trap_8c_a1d2232e9a45988578fcc60634f25e019}{trap\-\_\-set\-\_\-flag\-\_\-file} (char $\ast$filepath)
\item 
int \hyperlink{trap_8c_a1281c9216bff80ccce9e23f3ece9c0d3}{trap\-\_\-test} (const char $\ast$trap\-\_\-name)
\begin{DoxyCompactList}\small\item\em Return true if the named flag in the trap settings file is on. \end{DoxyCompactList}\item 
void \hyperlink{trap_8c_abe1776ccf2626cd4aff9446b9e7a28bd}{trap\-\_\-attach\-\_\-debugger} (const char $\ast$trap\-\_\-name, const char $\ast$comment)
\begin{DoxyCompactList}\small\item\em Hold up processing until the developer can attach the debugger to the blocked process. This function loops until the variable debugflag becomes non-\/zero. In gdb, this can be done by attaching to the process and entering the command \char`\"{}print debugflag=1\char`\"{}. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Debug support tool. Basically allows you to attach to a running process.

The trapfile contains name value pairs. A value of on turns on a trap ... a value of off turns off a trap. Text following a '\#' is ignored.

condition1=on \# condition 1 trap is on condition2=foo \# condition 2 trap is off condition3=off \# condition 3 trap if off

A trap state is checked by passing the trap name (like \char`\"{}condition1\char`\"{}) to the trap\-\_\-test function or the trap\-\_\-attach\-\_\-debugger function.

The file is re-\/read each time trap\-\_\-test is called, so the trap file can be edited on the fly.

Typical use\-:

Edit code to add a call to trap\-\_\-attach\-\_\-debugger(\char`\"{}mycondition\char`\"{}, \char`\"{}my comment\char`\"{}) Monitor the log file with tail -\/f' Edit the trapfile to set mycondition=on When log file starts showing trap commentary, attach the debugger to the process identified in the log file trap output. Set a break point inside the loop. Continue execution. Let the breakpoint trigger. Edit trapfile again to set mycondition=off. Set other breakpoints after call to trap\-\_\-attach\-\_\-debugger as needed. Continue execution.

Usually, one does not deliver code with traps still present in the source. But you can ... just be careful with the trapfile. 

Definition in file \hyperlink{trap_8c_source}{trap.\-c}.



\subsection{Function Documentation}
\hypertarget{trap_8c_abe1776ccf2626cd4aff9446b9e7a28bd}{\index{trap.\-c@{trap.\-c}!trap\-\_\-attach\-\_\-debugger@{trap\-\_\-attach\-\_\-debugger}}
\index{trap\-\_\-attach\-\_\-debugger@{trap\-\_\-attach\-\_\-debugger}!trap.c@{trap.\-c}}
\subsubsection[{trap\-\_\-attach\-\_\-debugger}]{\setlength{\rightskip}{0pt plus 5cm}void trap\-\_\-attach\-\_\-debugger (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{trap\-\_\-name, }
\item[{const char $\ast$}]{comment}
\end{DoxyParamCaption}
)}}\label{trap_8c_abe1776ccf2626cd4aff9446b9e7a28bd}


Hold up processing until the developer can attach the debugger to the blocked process. This function loops until the variable debugflag becomes non-\/zero. In gdb, this can be done by attaching to the process and entering the command \char`\"{}print debugflag=1\char`\"{}. 

The comment provided is written to the log file along with a T\-R\-A\-P advisoring given the pid of the blocked process.


\begin{DoxyParams}{Parameters}
{\em trap\-\_\-name} & -- name of the trap. If the trap is on, the blocking loop is engaged. \\
\hline
{\em comment} & -- comment to deposit in log file. Usually the program name. \\
\hline
\end{DoxyParams}


Definition at line 154 of file trap.\-c.

\hypertarget{trap_8c_a1d87e482edbb84f52b378e13112ac005}{\index{trap.\-c@{trap.\-c}!trap\-\_\-read\-\_\-trapfile@{trap\-\_\-read\-\_\-trapfile}}
\index{trap\-\_\-read\-\_\-trapfile@{trap\-\_\-read\-\_\-trapfile}!trap.c@{trap.\-c}}
\subsubsection[{trap\-\_\-read\-\_\-trapfile}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ trap\-\_\-read\-\_\-trapfile (
\begin{DoxyParamCaption}
\item[{{\bf I\-N\-I\-F\-I\-L\-E\-\_\-\-N\-O\-D\-E} $\ast$}]{inifilep}
\end{DoxyParamCaption}
)}}\label{trap_8c_a1d87e482edbb84f52b378e13112ac005}


Get the trap file name from the system initialization file. The function presumes sysconfig\-\_\-parse\-\_\-inifile has already occurred. 

The trapfile is specified in the \mbox{[}debug\mbox{]} section \mbox{[}debug\mbox{]} trapfile=/full/path/to/trap/file 

Definition at line 86 of file trap.\-c.

\hypertarget{trap_8c_a1d2232e9a45988578fcc60634f25e019}{\index{trap.\-c@{trap.\-c}!trap\-\_\-set\-\_\-flag\-\_\-file@{trap\-\_\-set\-\_\-flag\-\_\-file}}
\index{trap\-\_\-set\-\_\-flag\-\_\-file@{trap\-\_\-set\-\_\-flag\-\_\-file}!trap.c@{trap.\-c}}
\subsubsection[{trap\-\_\-set\-\_\-flag\-\_\-file}]{\setlength{\rightskip}{0pt plus 5cm}int trap\-\_\-set\-\_\-flag\-\_\-file (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{filepath}
\end{DoxyParamCaption}
)}}\label{trap_8c_a1d2232e9a45988578fcc60634f25e019}


Definition at line 100 of file trap.\-c.

\hypertarget{trap_8c_a1281c9216bff80ccce9e23f3ece9c0d3}{\index{trap.\-c@{trap.\-c}!trap\-\_\-test@{trap\-\_\-test}}
\index{trap\-\_\-test@{trap\-\_\-test}!trap.c@{trap.\-c}}
\subsubsection[{trap\-\_\-test}]{\setlength{\rightskip}{0pt plus 5cm}int trap\-\_\-test (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{trap\-\_\-name}
\end{DoxyParamCaption}
)}}\label{trap_8c_a1281c9216bff80ccce9e23f3ece9c0d3}


Return true if the named flag in the trap settings file is on. 


\begin{DoxyParams}{Parameters}
{\em trap\-\_\-name} & -- name of the trap flah \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 if the trap is on, 0 if not found or not on 
\end{DoxyReturn}


Definition at line 123 of file trap.\-c.

